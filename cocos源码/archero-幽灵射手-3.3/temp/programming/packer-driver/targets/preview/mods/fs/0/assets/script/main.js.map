{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/main.ts"],"names":["_decorator","Component","game","Game","PhysicsSystem","Node","profiler","AudioManager","GameManager","constant","clientEvent","playerData","StorageManager","localConfig","util","SdkUtil","ccclass","property","Main","onEnable","on","EVENT_TYPE","HIDE_LOADING_PANEL","_hideLoadingPanel","onDisable","off","start","frameRate","instance","getGlobalData","GAME_FRAME","window","wx","checkIsLowPhone","setGlobalData","console","log","setFrameRate","fixedTimeStep","isDebugOpen","showStats","hideStats","ndLoading","active","cocosAnalytics","init","appID","version","storeID","engine","loadGlobalCache","userId","generateRandomAccount","loadFromCache","playerInfo","createDate","createPlayerInfo","loadConfig","_loadFinish","shareGame","EVENT_HIDE","settings","hideTime","Date","now","saveAll","save","isFirstLoad","dispatchEvent","ON_GAME_INIT","parent","removeFromParent"],"mappings":"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","sourcesContent":["import { AudioManager } from './framework/audioManager';\nimport { GameManager } from './fight/gameManager';\nimport { constant } from './framework/constant';\nimport { clientEvent } from './framework/clientEvent';\nimport { _decorator, Component, game, Game, PhysicsSystem, Node, profiler, TERRAIN_HEIGHT_BASE } from 'cc';\nimport { playerData } from './framework/playerData';\nimport { StorageManager } from './framework/storageManager';\nimport { localConfig } from './framework/localConfig';\nimport { util } from './framework/util';\nimport { SdkUtil } from './framework/sdkUtil';\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('Main')\nexport class Main extends Component {\n    @property(Node)\n    public ndLoading: Node = null!;\n\n    onEnable () {\n        clientEvent.on(constant.EVENT_TYPE.HIDE_LOADING_PANEL, this._hideLoadingPanel, this);\n    }\n\n    onDisable () {\n        clientEvent.off(constant.EVENT_TYPE.HIDE_LOADING_PANEL, this._hideLoadingPanel, this);\n    }\n\n    start () {\n        let frameRate = StorageManager.instance.getGlobalData(\"frameRate\");\n        if (typeof frameRate !== \"number\") {\n            frameRate = constant.GAME_FRAME;\n            //@ts-ignore\n            if (window.wx && util.checkIsLowPhone()) {\n                frameRate = 30;\n            } \n\n            StorageManager.instance.setGlobalData(\"frameRate\", frameRate);\n        } \n\n        console.log(\"###frameRate\", frameRate);\n\n        game.setFrameRate(frameRate);\n        PhysicsSystem.instance.fixedTimeStep = 1 / frameRate;\n\n\n        let isDebugOpen = StorageManager.instance.getGlobalData(\"debug\") ?? false;\n        isDebugOpen === true ? profiler.showStats() : profiler.hideStats();\n\n        this.ndLoading.active = true;        \n\n        //@ts-ignore\n        if (window.cocosAnalytics) {\n            //@ts-ignore\n            window.cocosAnalytics.init({\n                appID: \"605630324\",              // 游戏ID\n                version: '1.0.0',           // 游戏/应用版本号\n                storeID: \"cocosPlay\",     // 分发渠道\n                engine: \"cocos\",            // 游戏引擎\n            });\n        }\n        \n        playerData.instance.loadGlobalCache();\n        if (!playerData.instance.userId) {\n            playerData.instance.generateRandomAccount();\n            console.log(\"###生成随机userId\", playerData.instance.userId);\n        }\n\n        playerData.instance.loadFromCache();\n\n        if (!playerData.instance.playerInfo || !playerData.instance.playerInfo.createDate) {\n            playerData.instance.createPlayerInfo();\n        }\n\n        //加载CSV相关配置\n        localConfig.instance.loadConfig(()=>{\n            this._loadFinish();\n            SdkUtil.shareGame(\"奔跑吧巨人\", \"\");\n        })\n\n        AudioManager.instance.init();\n\n        //test\n        // if (GameManager.isTesting) {\n        //     playerData.instance.playerInfo.level = 3;\n        //     playerData.instance.savePlayerInfoToLocalCache();\n        // }\n\n        //引导\n        //GuideManager.instance.start();\n\n        //加载子包\n        // SubPackageManager.instance.loadAllPackage();\n\n        //记录离线时间\n        game.on(Game.EVENT_HIDE, ()=>{\n            if (!playerData.instance.settings) {\n                playerData.instance.settings = {}\n            }\n\n            playerData.instance.settings.hideTime = Date.now();\n            playerData.instance.saveAll();\n            StorageManager.instance.save();\n        })\n    }\n\n    private _loadFinish () {\n        GameManager.isFirstLoad = true;\n        clientEvent.dispatchEvent(constant.EVENT_TYPE.ON_GAME_INIT);\n    }\n\n    private _hideLoadingPanel () {\n        if (this.ndLoading.parent) {\n            this.ndLoading.removeFromParent();\n        }\n    }\n\n    // update (deltaTime: number) {\n    //     // Your update function goes here.\n    // }\n}\n"]}