{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/framework/effectManager.ts"],"names":["_decorator","Component","AnimationComponent","ParticleSystemComponent","Vec3","find","AnimationClip","poolManager","resourceUtil","WarningCircle","Reward","WarningStrip","WarningLine","v3_goldPos","ccclass","property","EffectManager","start","playAni","path","aniName","worPos","isLoop","isRecycle","scale","callback","childName","split","ndEffect","ndParent","getChildByName","cb","setScale","setWorldPosition","ani","getComponent","play","aniState","getState","wrapMode","WrapMode","Loop","Normal","once","EventType","FINISHED","instance","putNode","loadModelRes","then","prefab","getNode","removeEffect","name","arrAni","getComponentsInChildren","forEach","element","stop","arrParticle","clear","playParticle","recycleTime","eulerAngles","loadEffectRes","maxDuration","item","simulationSpeed","duration","seconds","setTimeout","parent","playEffect","targetNode","effectPath","isPlayAni","isPlayParticle","pos","setPosition","idx","defaultClip","speed","showRewardBounce","ndMonster","modelPath","rewardNum","pf","i","ndReward","worldPosition","x","z","active","scriptReward","init","playTrail","showWarning","warningName","scriptParent","ndWarning","scriptWarning","showLightningChain","ndTarget","offsetPos","subtract","setWorldScale","length","forward","normalize","negative","_ndParent","_instance"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, AnimationComponent, ParticleSystemComponent, Vec3, find, AnimationState, AnimationClip, math } from 'cc';\nimport { poolManager } from './poolManager';\nimport { resourceUtil } from './resourceUtil';\nimport { WarningCircle } from '../fight/warningSkill/warningCircle';\nimport { Reward } from '../fight/reward';\nimport { WarningStrip } from '../fight/warningSkill/warningStrip';\nimport { WarningLine } from '../fight/warningSkill/warningLine';\n\nconst v3_goldPos: Vec3 = new Vec3();\nconst { ccclass, property } = _decorator;\n\n@ccclass('EffectManager')\nexport class EffectManager extends Component {\n    private _ndParent: Node = null!;\n    private _ndGoldParent: Node = null!\n    public get ndParent () {\n        if (!this._ndParent) {\n            this._ndParent = find(\"effectManager\") as Node;\n        }\n\n        return this._ndParent\n    }\n\n    static _instance: EffectManager;\n\n    static get instance () {\n        if (this._instance) {\n            return this._instance;\n        }\n\n        this._instance = new EffectManager();\n        return this._instance;\n    }\n\n    start () {\n       \n    }\n\n    /**\n     * 播放模型的动画\n     * @param {string} path 动画节点路径\n     * @param {string} aniName \n     * @param {vec3} worPos 世界坐标\n     * @param {boolean} isLoop 是否循环\n     * @param {boolean} isRecycle 是否回收\n     * @param {number} [scale=1] 缩放倍数 \n     * @param {Function} [callback=()=>{}] 回调函数 \n     */\n    public playAni (path: string, aniName: string, worPos: Vec3 = new Vec3(),  isLoop: boolean = false,  isRecycle: boolean = false, scale: number = 1, callback: Function = ()=>{}) {\n        let childName: string = path.split(\"/\")[1];\n        let ndEffect: Node | null = this.ndParent.getChildByName(childName);\n\n        let cb = ()=>{\n            ndEffect?.setScale(new Vec3(scale, scale, scale));\n            ndEffect?.setWorldPosition(worPos); \n            let ani: AnimationComponent= ndEffect?.getComponent(AnimationComponent) as AnimationComponent;\n            ani.play(aniName);\n            let aniState: AnimationState= ani.getState(aniName) as AnimationState;\n            if (aniState) {\n                if (isLoop) {\n                    aniState.wrapMode = AnimationClip.WrapMode.Loop;    \n                } else {\n                    aniState.wrapMode = AnimationClip.WrapMode.Normal;    \n                }\n            }\n\n            ani.once(AnimationComponent.EventType.FINISHED, ()=>{\n                callback && callback();\n                if (isRecycle && ndEffect) {\n                    poolManager.instance.putNode(ndEffect);\n                }\n            })\n        }\n\n        if (!ndEffect) {\n            resourceUtil.loadModelRes(path).then((prefab: any)=>{\n                ndEffect = poolManager.instance.getNode(prefab as Prefab, this.ndParent) as Node;\n                ndEffect.setScale(new Vec3(scale, scale, scale));\n                ndEffect.setWorldPosition(worPos);                \n                cb();\n            })\n        } else {\n          cb();\n        }\n    }\n\n    /**\n     * 移除特效\n     * @param {string} name  特效名称\n     * @param {Node}} ndParent 特效父节点\n     */\n    public removeEffect (name: string, ndParent: Node = this.ndParent) {\n        let ndEffect: Node | null = ndParent.getChildByName(name);\n        if (ndEffect) {\n            let arrAni: AnimationComponent[] = ndEffect.getComponentsInChildren(AnimationComponent);\n            arrAni.forEach((element: AnimationComponent)=>{    \n                element.stop();\n            })\n\n            let arrParticle: [] = ndEffect?.getComponentsInChildren(ParticleSystemComponent) as any;\n            arrParticle.forEach((element:ParticleSystemComponent)=>{\n                element?.clear();\n                element?.stop();\n            })\n            poolManager.instance.putNode(ndEffect);        \n        }\n    }\n\n    /**\n     * 播放粒子特效\n     * @param {string} path 特效路径\n     * @param {vec3}worPos 特效世界坐标 \n     * @param {number} [recycleTime=0] 特效节点回收时间，如果为0，则使用默认duration\n     * @param  {number} [scale=1] 缩放倍数\n     * @param {vec3} eulerAngles 特效角度\n     * @param {Function} [callback=()=>{}] 回调函数\n     */\n    public playParticle (path: string, worPos: Vec3,  recycleTime: number = 0, scale: number = 1, eulerAngles?: Vec3 | null, callback?: Function) {\n        resourceUtil.loadEffectRes(path).then((prefab: any)=>{\n            let ndEffect: Node = poolManager.instance.getNode(prefab as Prefab, this.ndParent) as Node;\n            ndEffect.setScale(new Vec3(scale, scale, scale));\n            ndEffect.setWorldPosition(worPos);  \n            \n            if (eulerAngles) {\n                ndEffect.eulerAngles = eulerAngles;\n            }\n            \n            let maxDuration: number = 0;\n\n            let arrParticle:  ParticleSystemComponent[]= ndEffect.getComponentsInChildren(ParticleSystemComponent);\n            arrParticle.forEach((item: ParticleSystemComponent)=>{\n                item.simulationSpeed = 1;\n                item?.clear();\n                item?.stop();\n                item?.play()\n\n                let duration: number= item.duration;\n                maxDuration = duration > maxDuration ? duration : maxDuration;\n            })\n\n            let seconds: number = recycleTime && recycleTime > 0 ? recycleTime : maxDuration;\n\n            setTimeout(()=>{\n                if (ndEffect.parent) {\n                    poolManager.instance.putNode(ndEffect);\n                    callback && callback();\n                }\n            }, seconds * 1000)  \n        })\n    }\n\n    /**\n     * 播放节点下面的动画和粒子\n     *\n     * @param {Node} targetNode 特效挂载节点\n     * @param {string} effectPath 特效路径\n     * @param {boolean} [isPlayAni=true] 是否播放动画\n     * @param {boolean} [isPlayParticle=true] 是否播放特效\n     * @param {number} [recycleTime=0] 特效节点回收时间，如果为0，则使用默认duration\n     * @param {number} [scale=1] 缩放倍数\n     * @param {Vec3} [pos=new Vec3()] 位移\n     * @param {Function} [callback=()=>{}] 回调函数\n     * @returns\n     * @memberof EffectManager\n     */\n    public playEffect (targetNode: Node, effectPath: string, isPlayAni: boolean = true, isPlayParticle: boolean = true, recycleTime: number = 0, scale: number = 1, pos?: Vec3 | null, eulerAngles?: Vec3 | null, callback?: Function) {\n        if (!targetNode.parent) {//父节点被回收的时候不播放\n            return;\n        }\n\n        resourceUtil.loadEffectRes(effectPath).then((prefab: any)=>{\n            let ndEffect: Node = poolManager.instance.getNode(prefab as Prefab, targetNode) as Node;\n            ndEffect.setScale(new Vec3(scale, scale, scale));\n\n            if (pos) {\n                ndEffect.setPosition(pos);\n            }\n\n            if (eulerAngles) {\n                ndEffect.eulerAngles = eulerAngles;\n            }\n\n            let maxDuration: number = 0;\n\n            if (isPlayAni) {\n                let arrAni: AnimationComponent[] = ndEffect.getComponentsInChildren(AnimationComponent);\n    \n                arrAni.forEach((element: AnimationComponent, idx: number)=>{\n                    element?.play();\n                    \n                    let aniName = element?.defaultClip?.name;\n                    if (aniName) {\n                        let aniState = element.getState(aniName);\n                        if (aniState) {\n                            let duration = aniState.duration;\n                            maxDuration = duration > maxDuration ? duration : maxDuration;\n\n                            aniState.speed = 1;\n                        }\n                    }\n                })\n            }\n    \n            if (isPlayParticle) {\n                let arrParticle: ParticleSystemComponent[]= ndEffect.getComponentsInChildren(ParticleSystemComponent);\n                arrParticle.forEach((element:ParticleSystemComponent)=>{\n                    element.simulationSpeed = 1;\n                    element?.clear();\n                    element?.stop();\n                    element?.play()\n    \n                    let duration: number= element.duration;\n                    maxDuration = duration > maxDuration ? duration : maxDuration;\n                })\n            }\n    \n            let seconds: number = recycleTime && recycleTime > 0 ? recycleTime : maxDuration;\n            \n            setTimeout(()=>{\n                if (ndEffect.parent) {\n                    poolManager.instance.putNode(ndEffect);\n                    callback && callback();\n                }\n            }, seconds * 1000)  \n        })\n    }\n\n    /**\n     * 展示奖励(金币、爱心)弹跳\n     *\n     * @param {Node} ndMonster\n     * @param {string} modelPath\n     * @param {number} [rewardNum=1]\n     * @param {Function} [callback=()=>{}]\n     * @memberof EffectManager\n     */\n    public showRewardBounce (ndMonster: Node, modelPath: string, rewardNum: number = 1, callback: Function = ()=>{}) {\n        resourceUtil.loadModelRes(modelPath).then((pf: any)=>{\n            for (let i = 0; i < rewardNum; i++) {\n                let ndReward = poolManager.instance.getNode(pf, this.ndParent) as Node;\n                ndReward.setWorldPosition(ndMonster.worldPosition.x, 1.65, ndMonster.worldPosition.z);\n                ndReward.active = false;\n                let scriptReward = ndReward.getComponent(Reward) as Reward;\n                scriptReward.init((i+1) * 0.15, this.ndParent);\n            }\n\n            callback && callback();\n        });\n    }\n\n    /**\n     * 播放拖尾特效\n     *\n     * @param {Node} ndParent\n     * @memberof EffectManager\n     */\n    public playTrail (ndParent: Node, recycleTime:number = 0, callback?:Function, speed: number = 1) {\n        let maxDuration: number = 0;\n\n        let arrParticle: ParticleSystemComponent[]= ndParent.getComponentsInChildren(ParticleSystemComponent);\n        arrParticle.forEach((element:ParticleSystemComponent)=>{\n            element.simulationSpeed = speed;\n            element?.clear();\n            element?.stop();\n            element?.play();\n\n            let duration: number= element.duration;\n            maxDuration = duration > maxDuration ? duration : maxDuration;\n        })\n\n        let seconds: number = recycleTime && recycleTime > 0 ? recycleTime : maxDuration;\n\n        setTimeout(()=>{\n            callback && callback();\n        }, seconds * 1000)  \n    }\n\n    /**\n     * 展示预警\n     *\n     * @param {string} warningName\n     * @param {number} scale\n     * @param {*} scriptParent\n     * @memberof EffectManager\n     */\n    public showWarning (warningName: string, scale: number, scriptParent: any, callback?: Function) {\n        resourceUtil.loadEffectRes(`warning/${warningName}`).then((pf: any)=>{\n            let ndWarning = poolManager.instance.getNode(pf, this.ndParent) as Node;\n\n            let scriptWarning: any = null; \n            if (warningName === \"warningLine\") {\n                scriptWarning = ndWarning.getComponent(WarningLine) as WarningLine;\n            } else if (warningName === \"warningStrip\") {\n                scriptWarning = ndWarning.getComponent(WarningStrip) as WarningStrip;\n            } else if (warningName === \"warningCircle\") {\n                scriptWarning = ndWarning.getComponent(WarningCircle) as WarningCircle;\n            }\n\n            scriptWarning.init(scale, scriptParent);\n\n            scriptParent.scriptWarning = scriptWarning;\n\n            callback && callback();\n        });\n    }\n\n    public showLightningChain (ndParent: Node, ndTarget: Node) {\n        resourceUtil.loadEffectRes(`lightningChain/lightningChain`).then((pf: any)=>{\n            let ndEffect = poolManager.instance.getNode(pf, ndParent) as Node;\n            ndEffect.setWorldPosition(new Vec3(ndParent.worldPosition.x, 2.3, ndParent.worldPosition.z));\n\n            let offsetPos: Vec3 = new Vec3();\n\n            Vec3.subtract(offsetPos, ndTarget.worldPosition, ndParent.worldPosition);\n            ndEffect.setWorldScale(1, offsetPos.length(), 1);\n            ndEffect.forward = offsetPos.normalize().negative();\n            \n            setTimeout(()=>{\n                poolManager.instance.putNode(ndEffect);\n            }, 100)\n        });\n    }\n}\n"]}