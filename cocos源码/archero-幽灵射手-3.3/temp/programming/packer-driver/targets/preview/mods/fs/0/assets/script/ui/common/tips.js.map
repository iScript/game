{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/ui/common/tips.ts"],"names":["_decorator","Component","LabelComponent","Vec3","tween","UIOpacityComponent","isValid","SpriteFrame","SpriteComponent","UITransformComponent","Color","poolManager","util","ccclass","property","tips","start","show","content","type","targetPos","scale","callback","_type","node","setScale","size","lbTips","getComponent","contentSize","instance","putNode","string","color","spBg","enabled","_movePos","set","_curTipPos","_tipSpeedAddTimes","_tipTotalHeight","_isShow","UIOpacityBg","opacity","spIcon","spriteFrame","sfGold","sfHeart","formatValue","Number","to","easing","call","setPosition","active","scheduleOnce","position","_uiTipTargetPos","update","deltaTime"],"mappings":"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","sourcesContent":["import { poolManager } from './../../framework/poolManager';\nimport { util } from './../../framework/util';\nimport { _decorator, Component, Node, LabelComponent, Vec3, tween, UIComponent, UITransform, UIOpacityComponent, isValid, UIOpacity, SpriteFrame, SpriteComponent, UITransformComponent, Color, find, Game, Sprite } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('tips')\nexport class tips extends Component {\n    @property(LabelComponent)\n    public lbTips: LabelComponent = null!;\n\n    @property(SpriteComponent)\n    public spIcon: SpriteComponent = null!;\n\n    @property(SpriteComponent)\n    public spBg: SpriteComponent = null!;\n\n    @property(UIOpacityComponent)\n    public UIOpacityBg: UIOpacityComponent = null!;\n\n    @property(SpriteFrame)\n    public sfGold: SpriteFrame = null!;\n\n    @property(SpriteFrame)\n    public sfHeart: SpriteFrame = null!;\n\n    private _isShow: boolean = false;\n    private _movePos: Vec3 = new Vec3();\n    private _curTipPos = new Vec3();\n    private _tipTotalHeight = 0;\n    private _tipSpeedAddTimes = 0;\n    private _type: string = '';\n    private _uiTipTargetPos: Vec3 = new Vec3(0, 230, 0);//文字提示目标位置\n\n    start () {\n\n    }\n\n    public show (content: string, type: string, targetPos: Vec3, scale: number, callback: Function = ()=>{}) {\n        this._type = type;\n        this.node.setScale(new Vec3(scale, scale, scale));\n\n        let size = this.lbTips?.node?.getComponent(UITransformComponent)?.contentSize;\n        if (!isValid(size)) {//size不存在，自我销毁\n            poolManager.instance.putNode(this.node);\n            return;\n        }\n\n        this.lbTips.string = content;\n        this.lbTips.color = new Color(214, 132, 53, 255);\n\n        if (type === 'gold' || type === 'heart') {\n            this.spBg.enabled = false;\n            this._movePos.set(0, 0, 0);\n            this._curTipPos.set(0, 0, 0);\n            this._tipSpeedAddTimes = 0;\n            this._tipTotalHeight = 0;\n            this._isShow = true;\n            this.UIOpacityBg.opacity = 50;\n\n            if (type === 'gold') {\n                this.spIcon.spriteFrame = this.sfGold;\n            } else if (type === 'heart') {\n                this.spIcon.spriteFrame = this.sfHeart;\n            }\n\n            this.lbTips.color = new Color(255,255,255,255);\n            this.lbTips.string = util.formatValue(Number(content));\n\n            tween(this.node)\n            .to(1.2, { scale: new Vec3(scale, scale, scale) }, { easing: 'smooth' })\n            .start();\n\n            tween(this.UIOpacityBg)\n            .to(0.8, { opacity: 255} , { easing: 'smooth' })\n            .to(0.4, { opacity: 0} , { easing: 'smooth' })\n            .call(()=>{\n                this._isShow = false;\n                callback && callback();\n                poolManager.instance.putNode(this.node);\n            })\n            .start();\n        } else {\n            //纯文字提示\n            this.spBg.enabled = true;\n            this.UIOpacityBg.opacity = 255;\n            this.node.setPosition(targetPos);\n\n            this.spIcon.node.active = false;\n\n            this.scheduleOnce(()=>{\n                tween(this.node)\n                .to(1.1, { position: this._uiTipTargetPos}, { easing: 'smooth' })\n                .call(()=>{\n                    callback && callback();\n                    poolManager.instance.putNode(this.node);\n                })\n                .start();\n\n                tween(this.UIOpacityBg)\n                .to(0.7, { opacity: 220} , { easing: 'smooth' })\n                .to(0.4, { opacity: 0} , { easing: 'smooth' })\n                .call(()=>{\n                \n                })\n                .start();\n            }, 0.8);\n        }\n    }\n    \n    update (deltaTime: number) {\n        // Your update function goes here.\n        \n        // if ((this.type === 'gold' || this.type === 'heart') && this.isShow && this.tipTotalHeight <= 70) {\n        //     GameManager.mainCamera.convertToUINode(this.targetPos, find('Canvas') as Node, this.movePos);\n        //     this.tipSpeedAddTimes += deltaTime * 10;\n        //     let ratio = 0.020 - this.tipSpeedAddTimes * 0.01;\n        //     ratio = ratio <= 0.01 ? 0.01 : ratio \n        //     let tipSpeed = Math.pow(this.tipSpeedAddTimes, 3) * ratio;\n        //     this.tipTotalHeight += tipSpeed;\n\n        //     this.curTipPos.add3f(0, tipSpeed,0);\n        //     this.movePos.add(this.curTipPos);\n        //     this.node.setPosition(this.movePos);\n        // }\n    }\n}\n"]}