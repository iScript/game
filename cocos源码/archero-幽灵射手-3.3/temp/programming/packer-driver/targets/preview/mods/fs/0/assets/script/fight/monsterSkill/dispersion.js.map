{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/fight/monsterSkill/dispersion.ts"],"names":["_decorator","Component","Node","Vec3","AudioManager","constant","EffectManager","poolManager","util","GameManager","ccclass","property","Dispersion","start","init","skillInfo","baseInfo","node","active","_oriPos","position","clone","_oriEulerAngles","eulerAngles","setPosition","set","_targetSpeed","flySpeed","_curSpeed","instance","playTrail","playSound","SOUND","ENERGY_BALL","hide","parent","isAllHide","children","every","ndChild","putNode","update","deltaTime","ndPlayer","isGameOver","isGamePause","lerp","_targetWorPos","translate","NodeSpace","LOCAL","_curWorPos","worldPosition","subtract","_offsetPos","length","_disappearRange"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec3, RigidBodyComponent, Game } from 'cc';\nimport { AudioManager } from '../../framework/audioManager';\nimport { constant } from '../../framework/constant';\nimport { EffectManager } from '../../framework/effectManager';\nimport { poolManager } from '../../framework/poolManager';\nimport { util } from '../../framework/util';\nimport { GameManager } from '../gameManager';\nconst { ccclass, property } = _decorator;\n//180度散射球组件: 挂载每个球上, 不是挂在父节点上\n@ccclass('Dispersion')\nexport class Dispersion extends Component {\n    public baseInfo: any = null!;//敌人基本信息\n    public skillInfo: any = null!;//技能信息\n\n    private _curSpeed: number = 0;//当前速度\n    private _targetSpeed: number = 0;//目标速度\n    private _oriPos: Vec3 = null!;//初始默认位置\n    private _oriEulerAngles: Vec3 = null!//初始默认角度\n    private _offsetPos: Vec3 = new Vec3();//和玩家之间的向量差\n    private _curWorPos: Vec3 = new Vec3();//当前节点世界坐标\n    private _disappearRange: number = 20;//箭节点超过玩家这个范围则隐藏\n    private _targetWorPos: Vec3 = new Vec3();//箭的下次目标位置\n    private _oriScale: Vec3 = new Vec3();//初始缩放大小\n\n    start () {\n        // [3]\n    }\n\n    /**\n    * 初始化 \n    */\n     public init (skillInfo: any, baseInfo: any) {\n        this.skillInfo = skillInfo;\n        this.baseInfo = baseInfo;\n        this.node.active = true;\n\n        if (!this._oriPos) {\n            this._oriPos = this.node.position.clone();\n        }\n\n        if (!this._oriEulerAngles) {\n            this._oriEulerAngles = this.node.eulerAngles.clone();\n        }\n        \n        this.node.setPosition(this._oriPos);\n        this.node.eulerAngles.set(this._oriEulerAngles);\n\n        this._targetSpeed = skillInfo.flySpeed;\n        this._curSpeed = skillInfo.flySpeed * 0.5;\n\n        EffectManager.instance.playTrail(this.node);\n\n        AudioManager.instance.playSound(constant.SOUND.ENERGY_BALL);  \n    }\n\n    /**\n     * 击中玩家后隐藏\n     *\n     * @memberof Arrow\n     */\n    public hide () {\n        if (!this.node.parent) {\n            return;\n        }\n\n       this.node.active = false;\n\n       //如果dispersionSurround组里所有的球都隐藏了则回收整个dispersion预制体\n       let isAllHide = this.node.parent?.children.every((ndChild: Node)=>{\n           return ndChild.active === false;\n       })\n\n       if (isAllHide && this.node.parent) {\n           poolManager.instance.putNode(this.node.parent);\n       }\n    }\n\n    update (deltaTime: number) {\n        if (!this.node.parent || !GameManager.ndPlayer || GameManager.isGameOver || GameManager.isGamePause) {\n            return;\n        }\n\n        //朝forward方向飞行\n        this._curSpeed = util.lerp(this._targetSpeed, this._curSpeed, 0.25);\n        this._targetWorPos.set(0, 0, -deltaTime * this._curSpeed);\n        this.node.translate(this._targetWorPos, Node.NodeSpace.LOCAL);\n\n        //超过玩家一定范围则隐藏\n        this._curWorPos.set(this.node.worldPosition);\n        Vec3.subtract(this._offsetPos, this._curWorPos, GameManager.ndPlayer.worldPosition);\n        if (this._offsetPos && this._offsetPos.length() >= this._disappearRange) {\n            this.hide();\n        }\n    }\n}"]}