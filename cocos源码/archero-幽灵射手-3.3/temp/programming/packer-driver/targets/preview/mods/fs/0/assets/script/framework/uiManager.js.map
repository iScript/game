{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/framework/uiManager.ts"],"names":["_decorator","find","isValid","Vec3","UITransformComponent","FightTip","resourceUtil","poolManager","tips","GameManager","PlayerBloodBar","MonsterBloodBar","constant","ccclass","property","SHOW_STR_INTERVAL_TIME","v3_playerBloodOffsetPos","v3_playerBloodScale","v3_monsterBloodOffsetPos","v3_monsterBloodScale","v3_targetPosOffset","uiManager","isDialogVisible","panelPath","_dictSharedPanel","hasOwnProperty","panel","active","parent","showDialog","args","cb","panelPriority","PRIORITY","NORMAL","_dictLoading","idxSplit","lastIndexOf","scriptName","slice","script","getComponent","script2","charAt","toUpperCase","show","apply","createUI","err","node","isCloseBeforeShow","console","error","priority","hideDialog","callback","ani","close","pushToPopupSeq","param","popupDialog","isShow","_arrPopupDialog","push","_checkPopupSeq","insertToPopupSeq","index","splice","shiftFromPopupSeq","shift","length","first","showTips","content","type","targetPos","scale","str","String","next","_showTipsAni","now","Date","_showTipsTime","spareTime","setTimeout","getUIPrefabRes","prefab","tipsNode","instance","getNode","tipScript","showPlayerBloodBar","scriptParent","totalBlood","offsetPos","ndBloodBar","scriptBloodBar","showMonsterBloodBar","showBloodTips","bloodNum","offset","ndTip","pos","mainCamera","convertToUINode","worldPosition","add","setPosition","scriptTip","_instance"],"mappings":"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","sourcesContent":["import { FightTip } from './../ui/common/fightTip';\nimport { _decorator, Node, find, isValid, Vec3, UITransformComponent } from \"cc\";\nimport { resourceUtil } from \"./resourceUtil\";\nimport { poolManager } from \"./poolManager\";\nimport { tips } from \"../ui/common/tips\";\nimport { GameManager } from '../fight/gameManager';\nimport { PlayerBloodBar } from '../ui/fight/playerBloodBar';\nimport { MonsterBloodBar } from '../ui/fight/monsterBloodBar';\nimport { constant } from './constant';\nconst { ccclass, property } = _decorator;\n\nlet SHOW_STR_INTERVAL_TIME = 800;\nlet v3_playerBloodOffsetPos = new Vec3(-10, 100, 0);//血条距离玩家节点位置\nlet v3_playerBloodScale= new Vec3(1.5, 1.5, 1.5);//玩家血条缩放大小\nlet v3_monsterBloodOffsetPos = new Vec3(-10, 100, 0);//血条距离小怪节点位置\nlet v3_monsterBloodScale = new Vec3(1.5, 1.5, 1.5);//小怪血条缩放大小\nlet v3_targetPosOffset = new Vec3(0, 200, 0);//缓动目标位置\n\n@ccclass(\"uiManager\")\nexport class uiManager {\n    private _dictSharedPanel: any = {}\n    private _dictLoading: any = {}\n    private _arrPopupDialog: any = []\n    private _showTipsTime: number = 0\n\n    private static _instance: uiManager;\n\n    public static get instance () {\n        if (this._instance) {\n            return this._instance;\n        }\n\n        this._instance = new uiManager();\n        return this._instance;\n    }\n\n    /**\n     * 检查当前界面是否正在展示\n     * @param panelPath \n     */\n    public isDialogVisible (panelPath:string) {\n        if (!this._dictSharedPanel.hasOwnProperty(panelPath)) {\n            return false;\n        }\n\n        let panel = this._dictSharedPanel[panelPath];\n\n        return isValid(panel) && panel.active && panel.parent;\n    }\n\n\n    /**\n     * 显示单例界面\n     * @param {String} panelPath \n     * @param {Array} args \n     * @param {Function} cb 回调函数，创建完毕后回调\n     */\n    public showDialog(panelPath:string, args?: any, cb?: Function, panelPriority: number = constant.PRIORITY.NORMAL) {\n        if (this._dictLoading[panelPath]) {\n            return;\n        }\n\n        let idxSplit = panelPath.lastIndexOf('/');\n        let scriptName = panelPath.slice(idxSplit + 1);\n        \n        if (!args) {\n            args = [];\n        }\n\n        if (this._dictSharedPanel.hasOwnProperty(panelPath)) {\n            let panel = this._dictSharedPanel[panelPath];\n            if (isValid(panel)) {\n                panel.parent = find(\"Canvas\");\n                panel.active = true;\n                let script = panel.getComponent(scriptName);\n                let script2 = panel.getComponent(scriptName.charAt(0).toUpperCase() + scriptName.slice(1));\n\n                if (script && script.show) {\n                    script.show.apply(script, args);\n                    cb && cb(script);   \n                } else if (script2 && script2.show){\n                    script2.show.apply(script2, args);               \n                    cb && cb(script2);\n                } else {\n                    throw `查找不到脚本文件${scriptName}`;\n                }\n\n                return;\n            }\n        }\n\n        this._dictLoading[panelPath] = true;\n        resourceUtil.createUI(panelPath, (err: any, node: any) => {\n            //判断是否有可能在显示前已经被关掉了？\n            let isCloseBeforeShow = false;\n            if (!this._dictLoading[panelPath]) {\n                //已经被关掉\n                isCloseBeforeShow = true;\n            }\n\n            this._dictLoading[panelPath] = false;\n            if (err) {\n                console.error(err);\n                return;\n            }\n\n            node.getComponent(UITransformComponent).priority = panelPriority;\n\n            this._dictSharedPanel[panelPath] = node;\n\n            let script: any = node.getComponent(scriptName);\n            let script2: any = node.getComponent(scriptName.charAt(0).toUpperCase() + scriptName.slice(1));\n            if (script && script.show) {\n                script.show.apply(script, args);\n                cb && cb(script);   \n            } else if (script2 && script2.show){\n                script2.show.apply(script2, args);               \n                cb && cb(script2);\n            } else {\n                throw `查找不到脚本文件${scriptName}`;\n            }\n\n            if (isCloseBeforeShow) {\n                //如果在显示前又被关闭，则直接触发关闭掉\n                this.hideDialog(panelPath);\n            }\n        });\n    }\n\n    /**\n     * 隐藏单例界面\n     * @param {String} panelPath \n     * @param {fn} callback\n     */\n    public hideDialog(panelPath: string, callback?: Function) {\n        if (this._dictSharedPanel.hasOwnProperty(panelPath)) {\n            let panel = this._dictSharedPanel[panelPath];\n            if (panel && isValid(panel)) {\n                let ani = panel.getComponent('animationUI');\n                if (ani) {\n                    ani.close(() => {\n                        panel.parent = null;\n                        if (callback && typeof callback === 'function') {\n                            callback();\n                        }\n                    });\n                } else {\n                    panel.parent = null;\n                    if (callback && typeof callback === 'function') {\n                        callback();\n                    }\n                }\n            } else if (callback && typeof callback === 'function') {\n                callback();\n            }\n        }\n\n        this._dictLoading[panelPath] = false;\n    }\n\n    /**\n     * 将弹窗加入弹出窗队列\n     * @param {string} panelPath \n     * @param {string} scriptName \n     * @param {*} param \n     */\n    public pushToPopupSeq(panelPath: string, scriptName: string, param: any) {\n        let popupDialog = {\n            panelPath: panelPath,\n            scriptName: scriptName,\n            param: param,\n            isShow: false\n        };\n\n        this._arrPopupDialog.push(popupDialog);\n\n        this._checkPopupSeq();\n    }\n\n    /**\n     * 将弹窗加入弹出窗队列\n     * @param {number} index \n     * @param {string} panelPath \n     * @param {string} scriptName \n     * @param {*} param \n     */\n    public insertToPopupSeq(index: number, panelPath: string, param: any) {\n        let popupDialog = {\n            panelPath: panelPath,\n            param: param,\n            isShow: false\n        };\n\n        this._arrPopupDialog.splice(index, 0, popupDialog);\n        //this._checkPopupSeq();\n    }\n\n    /**\n     * 将弹窗从弹出窗队列中移除\n     * @param {string} panelPath \n     */\n    public shiftFromPopupSeq(panelPath: string) {\n        this.hideDialog(panelPath, () => {\n            if (this._arrPopupDialog[0] && this._arrPopupDialog[0].panelPath === panelPath) {\n                this._arrPopupDialog.shift();\n                this._checkPopupSeq();\n            }\n        })\n    }\n\n    /**\n     * 检查当前是否需要弹窗\n     */\n    private _checkPopupSeq() {\n        if (this._arrPopupDialog.length > 0) {\n            let first = this._arrPopupDialog[0];\n\n            if (!first.isShow) {\n                this.showDialog(first.panelPath, first.param);\n                this._arrPopupDialog[0].isShow = true;\n            }\n        }\n    }\n\n    /**\n     * 显示提示\n     * @param {String} content \n     * @param {Function} cb \n     */\n    public showTips (content: string | number, type: string = 'txt', targetPos: Vec3 = new Vec3(),  scale: number = 1, callback: Function = ()=>{}) {\n        let str = String(content);\n        let next = ()=>{\n            this._showTipsAni(str, type, targetPos, scale, callback);\n        }\n\n        var now = Date.now();\n        if (now - this._showTipsTime < SHOW_STR_INTERVAL_TIME && type !== 'gold' && type !== 'heart') {\n            var spareTime = SHOW_STR_INTERVAL_TIME - (now - this._showTipsTime);\n            setTimeout(() =>{\n                next();\n            }, spareTime);\n\n            this._showTipsTime = now + spareTime;\n        } else {\n            next();\n            this._showTipsTime = now;\n        }\n    }\n \n    /**\n     * 内部函数\n     * @param {String} content \n     * @param {Function} cb \n     */\n    private _showTipsAni (content: string, type: string, targetPos: Vec3, scale: number, callback?: Function) {\n        resourceUtil.getUIPrefabRes('common/tips', function (err: any, prefab: any) {\n            if (err) {\n                return;\n            }\n\n            let tipsNode = poolManager.instance.getNode(prefab, find(\"Canvas\") as Node);\n\n            let tipScript = tipsNode.getComponent(tips) as tips;\n            tipScript.show(content, type, targetPos, scale, callback);\n        });\n    }\n\n    /**\n     * 展示血条\n     * @param scriptParent \n     * @param totalBlood \n     * @param bloodBarType \n     * @param offsetPos \n     * @param scale \n     */\n    public showPlayerBloodBar (scriptParent: any, totalBlood: number, callback: Function = ()=>{}, offsetPos: Vec3 = v3_playerBloodOffsetPos, scale: Vec3 = v3_playerBloodScale) {\n        resourceUtil.getUIPrefabRes('fight/playerBloodBar', function (err: any, prefab: any) {\n            if (err) {\n                return;\n            }\n\n            let ndBloodBar = poolManager.instance.getNode(prefab, find(\"Canvas\") as Node);\n            let scriptBloodBar = ndBloodBar.getComponent(PlayerBloodBar) as PlayerBloodBar;\n            scriptParent.scriptBloodBar = scriptBloodBar;\n            scriptBloodBar.show(scriptParent, totalBlood, offsetPos, scale, callback);\n        });\n    }\n\n    /**\n     * 展示小怪血条\n     *  \n     * @param {*} scriptParent \n     * @param {number} totalBlood\n     * @param {number} bloodBarType\n     * @param {Function} [callback=()=>{}]\n     * @param {Vec3} [offsetPos=MONSTER_BLOOD_OFFSET_POS]\n     * @param {Vec3} [scale=MONSTER_BLOOD_SCALE]\n     * @memberof uiManager\n     */\n    public showMonsterBloodBar (scriptParent: any, totalBlood: number, callback: Function = ()=>{}, offsetPos: Vec3 = v3_monsterBloodOffsetPos, scale: Vec3 = v3_monsterBloodScale) {\n        resourceUtil.getUIPrefabRes('fight/monsterBloodBar', function (err: any, prefab: any) {\n            if (err) {\n                return;\n            }\n\n            let ndBloodBar = poolManager.instance.getNode(prefab, find(\"Canvas\") as Node);\n            let scriptBloodBar = ndBloodBar.getComponent(MonsterBloodBar) as MonsterBloodBar;\n            scriptParent.scriptBloodBar = scriptBloodBar;\n            scriptBloodBar.show(scriptParent, totalBlood, offsetPos, scale, callback);\n        });\n    }\n\n    /**\n     * 展示血量提示\n     */\n    public showBloodTips (scriptParent: any, type: number, bloodNum: number, offset: Vec3, callback?: Function) {\n        resourceUtil.getUIPrefabRes('common/fightTip',  (err: any, prefab: any)=> {\n            if (err) {\n                return;\n            }\n\n            let ndTip = <Node>poolManager.instance.getNode(prefab,  <Node>find(\"Canvas\"));\n            let pos = GameManager.mainCamera?.convertToUINode(scriptParent.node.worldPosition, find('Canvas') as Node) as Vec3;\n            pos.add(offset);\n            ndTip.setPosition(pos);\n            \n            let scriptTip = ndTip.getComponent(FightTip) as FightTip;\n            scriptTip.show(scriptParent, type, bloodNum, callback);\n        });\n    }\n}\n"]}