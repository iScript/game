{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/ui/revive/revivePanel.ts"],"names":["_decorator","Component","Node","SpriteComponent","LabelComponent","UITransformComponent","playerData","clientEvent","constant","SdkUtil","uiManager","AudioManager","ccclass","property","RevivePanel","start","show","callback","_countDown","_curMaskHeight","_callback","updatePayIcon","SHARE_ID","REVIVE","spPayIcon","onBtnSkipClick","instance","playSound","SOUND","CLICK","_close","onBtnReviveClick","pay","err","hideDialog","showDialog","dispatchEvent","EVENT_TYPE","ON_REVIVE","update","deltaTime","countDown","isWatchVideoAd","value","lbCountDown","string","String","Math","floor","lbLevel","playerInfo","level","_maxMaskHeight","ndMask","getComponent","setContentSize"],"mappings":"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","sourcesContent":["import { playerData } from './../../framework/playerData';\nimport { _decorator, Component, Node, Sprite, SpriteComponent, LabelComponent, UITransformComponent } from 'cc';\nimport { clientEvent } from '../../framework/clientEvent';\nimport { constant } from '../../framework/constant';\nimport { SdkUtil } from '../../framework/sdkUtil';\nimport { uiManager } from '../../framework/uiManager';\nimport { AudioManager } from '../../framework/audioManager';\nconst { ccclass, property } = _decorator;\n//复活界面\n@ccclass('RevivePanel')\nexport class RevivePanel extends Component {\n    @property(SpriteComponent)\n    public spPayIcon: SpriteComponent = null!;\n\n    @property(LabelComponent)\n    public lbLevel: LabelComponent = null!;\n\n    @property(Node)\n    public ndMask: Node = null!;\n\n    @property(LabelComponent)\n    public lbCountDown: LabelComponent = null!;\n\n    public set countDown (value: number) {\n        this._countDown = value;\n        this.lbCountDown.string = String(Math.floor(this._countDown));\n        this.lbLevel.string = playerData.instance.playerInfo.level;\n\n        this._curMaskHeight += this._maxMaskHeight / (this._countDown * 120);\n        this._curMaskHeight = this._curMaskHeight >= this._maxMaskHeight ? this._maxMaskHeight : this._curMaskHeight;\n        this.ndMask.getComponent(UITransformComponent)?.setContentSize(260, this._curMaskHeight);\n\n        if (value < 0) {\n           this._close();\n        }\n    } \n\n    public get countDown () {\n        return this._countDown;\n    }\n\n    private _countDown: number = 10;\n    private _maxMaskHeight: number = 190;\n    private _curMaskHeight: number = 0;\n    private _callback: Function = null!;\n\n    start () {\n        // [3]\n    }\n\n    public show (callback: Function) {\n        this._countDown = 10;\n        this._curMaskHeight = 0;\n        this._callback = callback;\n\n        SdkUtil.updatePayIcon(constant.SHARE_ID.REVIVE, this.spPayIcon);\n    }\n\n    public onBtnSkipClick () {\n        AudioManager.instance.playSound(constant.SOUND.CLICK);\n\n        this._close()\n    }\n\n    public onBtnReviveClick () {\n        AudioManager.instance.playSound(constant.SOUND.CLICK);\n\n        SdkUtil.pay(constant.SHARE_ID.REVIVE, (err: any)=>{\n            if (!err) {\n                uiManager.instance.hideDialog(\"revive/revivePanel\");\n                uiManager.instance.showDialog(\"fight/fightPanel\");\n                clientEvent.dispatchEvent(constant.EVENT_TYPE.ON_REVIVE);\n            }\n        })\n    }\n\n    private _close () {\n        this._callback && this._callback();\n        uiManager.instance.hideDialog(\"revive/revivePanel\");\n        uiManager.instance.showDialog(\"settlement/settlementPanel\");\n    }\n\n    update (deltaTime: number) {\n        if (this.countDown > 0 && !SdkUtil.isWatchVideoAd) {\n            this.countDown -= deltaTime;\n        }\n    }\n\n    // update (deltaTime: number) {\n    //     // [4]\n    // }\n}\n"]}