{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/fight/playerModel.ts"],"names":["_decorator","Component","Node","Vec3","AnimationClip","SkeletalAnimationComponent","GameManager","constant","AudioManager","ccclass","property","PlayerModel","start","init","hideArrow","onFrameAttackLoose","isGameOver","isGamePause","looseEulerAngles","node","parent","eulerAngles","scriptPlayer","throwArrowToEnemy","ndArrow","active","onFrameRun","_stepIndex","instance","playSound","SOUND","FOOT_STEP","onFrameAttackDraw","playAni","aniType","isLoop","callback","pos","_aniState","aniComPlayer","getState","isPlaying","_aniType","PLAYER_ANI_TYPE","ATTACK","play","isAniPlaying","wrapMode","WrapMode","Loop","Normal","speed","gameSpeed","curAttackSpeed","hideRunSmoke","RUN","curMoveSpeed","playerBaseInfo","moveSpeed","playRunSmoke","IDLE","once","EventType","FINISHED"],"mappings":"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","sourcesContent":["import { util } from './../framework/util';\nimport { EffectManager } from './../framework/effectManager';\nimport { GameManager } from './gameManager';\nimport { _decorator, Component, Node, Vec3, SkeletalAnimationState, AnimationClip, SkeletalAnimationComponent, Game } from 'cc';\nimport { constant } from '../framework/constant';\nimport { AudioManager } from '../framework/audioManager';\nconst { ccclass, property } = _decorator;\n\n@ccclass('PlayerModel')\nexport class PlayerModel extends Component {\n    @property(Node)\n    public ndSocketLoose: Node = null!//弓箭发射的节点\n\n    @property(Node)\n    public ndSocketHand: Node = null!//手节点\n\n    @property(Node)\n    public ndArrow: Node = null!;//攻击时候展示的弓箭\n\n    @property(SkeletalAnimationComponent)\n    public aniComPlayer: SkeletalAnimationComponent = null!;//动画播放组件\n\n    public looseEulerAngles: Vec3 = new Vec3();//射箭时的角度\n    public isAniPlaying: boolean = false;//当前动画是否正在播放\n\n    //是否正在跑\n    public get isRunning () {\n        return this._aniType === constant.PLAYER_ANI_TYPE.RUN && this.isAniPlaying === true;\n    }\n\n    //是否站立\n    public get isIdle () {\n        return this._aniType === constant.PLAYER_ANI_TYPE.IDLE && this.isAniPlaying === true;\n    }\n\n    //是否正在攻击\n    public get isAttacking () {\n        return this._aniType === constant.PLAYER_ANI_TYPE.ATTACK && this.isAniPlaying === true;\n    } \n\n    private _aniType: string = \"\";//动画类型\n    private _aniState: SkeletalAnimationState = null!;//动画播放状态\n    private _stepIndex: number = 0;//脚步\n\n\n    start () {\n        // [3]\n    }\n\n    public init () {\n        this.hideArrow();\n    }\n\n    public onFrameAttackLoose () {\n        if (GameManager.isGameOver || GameManager.isGamePause) {\n            return;\n        }\n        \n        this.looseEulerAngles = this.node.parent?.eulerAngles as Vec3;\n        GameManager.scriptPlayer.throwArrowToEnemy();\n        this.ndArrow.active = false;\n\n        // console.log(\"looseEulerAngles\", this.looseEulerAngles);\n    }\n\n    /**\n     * 跑步的时候播放音效\n     */\n    public onFrameRun () {\n        this._stepIndex = this._stepIndex === 0 ? 1 : 0;\n        AudioManager.instance.playSound(constant.SOUND.FOOT_STEP[this._stepIndex]);  \n    }\n\n    public onFrameAttackDraw () {\n        this.ndArrow.active = true;\n    }\n    \n    public hideArrow () {\n        this.ndArrow.active = false;\n    }\n\n        /**\n     * 播放玩家动画\n     *\n     * @param {string} aniType 动画类型\n     * @param {boolean} [isLoop=false] 是否循环\n     * @param {Function} [callback] 回调函数\n     * @param {number} [callback] 调用播放动画的位置，方便用于测试\n     * @returns\n     * @memberof Player\n     */\n    public playAni (aniType: string, isLoop: boolean = false, callback?: Function, pos?: number) {\n        // console.log(\"playerAniType\", aniType, \"curAni\", this.aniType, \"pos\", pos);\n        this._aniState = this.aniComPlayer?.getState(aniType) as SkeletalAnimationState;\n\n        if (this._aniState && this._aniState.isPlaying) {\n            return;\n        }\n\n        this._aniType = aniType;\n\n        if (this._aniType !== constant.PLAYER_ANI_TYPE.ATTACK) {\n            this.hideArrow();\n        }\n\n        this.aniComPlayer?.play(aniType);\n        this.isAniPlaying = true;\n\n        if (this._aniState) {\n            if (isLoop) {\n                this._aniState.wrapMode = AnimationClip.WrapMode.Loop;    \n            } else {\n                this._aniState.wrapMode = AnimationClip.WrapMode.Normal;    \n            }\n\n            switch (aniType) {\n                case constant.PLAYER_ANI_TYPE.ATTACK:\n                    this._aniState.speed = GameManager.gameSpeed * GameManager.scriptPlayer.curAttackSpeed;\n                    GameManager.scriptPlayer.hideRunSmoke();\n                    break;\n                case constant.PLAYER_ANI_TYPE.RUN:\n                    this._aniState.speed = GameManager.gameSpeed * (GameManager.scriptPlayer.curMoveSpeed / GameManager.scriptPlayer.playerBaseInfo.moveSpeed);\n                    GameManager.scriptPlayer.playRunSmoke(); \n                    break;\n                case constant.PLAYER_ANI_TYPE.IDLE:\n                    this._aniState.speed = GameManager.gameSpeed;\n                    break;\n                default:\n                    this._aniState.speed = GameManager.gameSpeed;\n                    break;\n            }\n        }\n\n        if (!isLoop) {\n            this.aniComPlayer.once(SkeletalAnimationComponent.EventType.FINISHED, ()=>{\n                this.isAniPlaying = false;\n                callback && callback();\n            })\n        }\n    }\n\n\n    // update (deltaTime: number) {\n    //     // [4]\n    // }\n}"]}