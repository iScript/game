{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/ui/revive/revivePanel.ts"],"names":["_decorator","Component","Node","SpriteComponent","LabelComponent","UITransformComponent","playerData","clientEvent","constant","SdkUtil","uiManager","AudioManager","ccclass","property","RevivePanel","countDown","value","_countDown","lbCountDown","string","String","Math","floor","lbLevel","instance","playerInfo","level","_curMaskHeight","_maxMaskHeight","ndMask","getComponent","setContentSize","_close","start","show","callback","_callback","updatePayIcon","SHARE_ID","REVIVE","spPayIcon","onBtnSkipClick","playSound","SOUND","CLICK","onBtnReviveClick","pay","err","hideDialog","showDialog","dispatchEvent","EVENT_TYPE","ON_REVIVE","update","deltaTime","isWatchVideoAd"],"mappings":"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","sourcesContent":["import { playerData } from './../../framework/playerData';\nimport { _decorator, Component, Node, Sprite, SpriteComponent, LabelComponent, UITransformComponent } from 'cc';\nimport { clientEvent } from '../../framework/clientEvent';\nimport { constant } from '../../framework/constant';\nimport { SdkUtil } from '../../framework/sdkUtil';\nimport { uiManager } from '../../framework/uiManager';\nimport { AudioManager } from '../../framework/audioManager';\nconst { ccclass, property } = _decorator;\n//复活界面\n@ccclass('RevivePanel')\nexport class RevivePanel extends Component {\n    @property(SpriteComponent)\n    public spPayIcon: SpriteComponent = null!;\n\n    @property(LabelComponent)\n    public lbLevel: LabelComponent = null!;\n\n    @property(Node)\n    public ndMask: Node = null!;\n\n    @property(LabelComponent)\n    public lbCountDown: LabelComponent = null!;\n\n    public set countDown (value: number) {\n        this._countDown = value;\n        this.lbCountDown.string = String(Math.floor(this._countDown));\n        this.lbLevel.string = playerData.instance.playerInfo.level;\n\n        this._curMaskHeight += this._maxMaskHeight / (this._countDown * 120);\n        this._curMaskHeight = this._curMaskHeight >= this._maxMaskHeight ? this._maxMaskHeight : this._curMaskHeight;\n        this.ndMask.getComponent(UITransformComponent)?.setContentSize(260, this._curMaskHeight);\n\n        if (value < 0) {\n           this._close();\n        }\n    } \n\n    public get countDown () {\n        return this._countDown;\n    }\n\n    private _countDown: number = 10;\n    private _maxMaskHeight: number = 190;\n    private _curMaskHeight: number = 0;\n    private _callback: Function = null!;\n\n    start () {\n        // [3]\n    }\n\n    public show (callback: Function) {\n        this._countDown = 10;\n        this._curMaskHeight = 0;\n        this._callback = callback;\n\n        SdkUtil.updatePayIcon(constant.SHARE_ID.REVIVE, this.spPayIcon);\n    }\n\n    public onBtnSkipClick () {\n        AudioManager.instance.playSound(constant.SOUND.CLICK);\n\n        this._close()\n    }\n\n    public onBtnReviveClick () {\n        AudioManager.instance.playSound(constant.SOUND.CLICK);\n\n        SdkUtil.pay(constant.SHARE_ID.REVIVE, (err: any)=>{\n            if (!err) {\n                uiManager.instance.hideDialog(\"revive/revivePanel\");\n                uiManager.instance.showDialog(\"fight/fightPanel\");\n                clientEvent.dispatchEvent(constant.EVENT_TYPE.ON_REVIVE);\n            }\n        })\n    }\n\n    private _close () {\n        this._callback && this._callback();\n        uiManager.instance.hideDialog(\"revive/revivePanel\");\n        uiManager.instance.showDialog(\"settlement/settlementPanel\");\n    }\n\n    update (deltaTime: number) {\n        if (this.countDown > 0 && !SdkUtil.isWatchVideoAd) {\n            this.countDown -= deltaTime;\n        }\n    }\n\n    // update (deltaTime: number) {\n    //     // [4]\n    // }\n}\n"]}