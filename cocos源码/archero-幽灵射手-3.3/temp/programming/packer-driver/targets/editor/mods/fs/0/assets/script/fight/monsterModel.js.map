{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/fight/monsterModel.ts"],"names":["_decorator","Component","SkeletalAnimationComponent","AnimationClip","constant","GameManager","ccclass","property","MonsterModel","isRunning","_aniType","MONSTER_ANI_TYPE","RUN","isAniPlaying","isIdle","IDLE","isAttacking","ATTACK","ATTACK_1","ATTACK_2","isHitting","HIT","start","onFrameAttack","isNormalAttack","isGameOver","isGamePause","scriptMonster","releaseSkillToPlayer","playAni","aniType","isLoop","callback","pos","aniComPlayer","play","_aniState","getState","wrapMode","WrapMode","Loop","Normal","speed","gameSpeed","attackSpeedAddition","curAttackSpeed","curMoveSpeed","moveSpeedAddition","baseInfo","moveSpeed","once","EventType","FINISHED"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, SkeletalAnimationComponent, SkeletalAnimationState, AnimationClip } from 'cc';\nimport { constant } from '../framework/constant';\nimport { GameManager } from './gameManager';\nimport { Monster } from './monster';\nconst { ccclass, property } = _decorator;\n\n@ccclass('MonsterModel')\nexport class MonsterModel extends Component {\n    @property(SkeletalAnimationComponent)\n    public aniComPlayer: SkeletalAnimationComponent = null!;//动画播放组件\n\n    public isAniPlaying: Boolean = false;//当前动画是否正在播放\n    public scriptMonster: Monster = null!;\n\n    private _aniType: string = \"\";//动画类型\n    private _aniState: SkeletalAnimationState = null!;//动画播放状态\n\n    //是否正在跑\n     public get isRunning () {\n        return this._aniType === constant.MONSTER_ANI_TYPE.RUN && this.isAniPlaying;\n    }\n\n    //是否站立\n    public get isIdle () {\n        return this._aniType === constant.MONSTER_ANI_TYPE.IDLE && this.isAniPlaying;\n    }\n\n    //是否正在攻击\n    public get isAttacking () {\n        return (this._aniType === constant.MONSTER_ANI_TYPE.ATTACK  && this.isAniPlaying)\n            || (this._aniType === constant.MONSTER_ANI_TYPE.ATTACK_1 && this.isAniPlaying)\n            || (this._aniType === constant.MONSTER_ANI_TYPE.ATTACK_2  && this.isAniPlaying);\n    } \n\n    //是否正在受到攻击\n    public get isHitting () {\n        return this._aniType === constant.MONSTER_ANI_TYPE.HIT && this.isAniPlaying;;\n    } \n\n    start () {\n        // [3]\n    }\n\n    /**\n     * attack动画帧事件\n     * @returns \n     */\n    onFrameAttack (isNormalAttack: boolean = true) {\n        if (GameManager.isGameOver || GameManager.isGamePause) {\n            return;\n        }\n\n        this.scriptMonster.releaseSkillToPlayer(isNormalAttack);\n    }\n\n    /**\n     * 播放小怪动画\n     *\n     * @param {string} aniType 动画类型\n     * @param {boolean} [isLoop=false] 是否循环\n     * @param {Function} [callback] 回调函数\n     * @param {number} [pos] 调用播放动画的位置，方便用于测试\n     * @returns\n     * @memberof Player\n     */\n     public playAni (aniType: string, isLoop: boolean = false, callback?: Function, pos?: number) {\n        // console.log(\"monsterAniType\", aniType, \"curAni\", this._aniType, \"pos\", pos);\n\n        this._aniType = aniType;\n        this.aniComPlayer?.play(aniType);\n        this.isAniPlaying = true;\n\n        this._aniState = this.aniComPlayer?.getState(aniType) as SkeletalAnimationState;\n\n        if (this._aniState) {\n            if (isLoop) {\n                this._aniState.wrapMode = AnimationClip.WrapMode.Loop;    \n            } else {\n                this._aniState.wrapMode = AnimationClip.WrapMode.Normal;    \n            }\n\n            switch (aniType) {\n                case constant.MONSTER_ANI_TYPE.ATTACK:\n                    this._aniState.speed = GameManager.gameSpeed * GameManager.attackSpeedAddition * this.scriptMonster.curAttackSpeed;\n                    break;\n                case constant.MONSTER_ANI_TYPE.ATTACK_1:\n                    this._aniState.speed = GameManager.gameSpeed * GameManager.attackSpeedAddition * this.scriptMonster.curAttackSpeed;\n                    break;\n                case constant.MONSTER_ANI_TYPE.ATTACK_2:\n                    this._aniState.speed = GameManager.gameSpeed * GameManager.attackSpeedAddition * this.scriptMonster.curAttackSpeed;\n                    break;\n                case constant.MONSTER_ANI_TYPE.RUN:\n                    this._aniState.speed = GameManager.gameSpeed * (this.scriptMonster.curMoveSpeed * GameManager.moveSpeedAddition / this.scriptMonster.baseInfo.moveSpeed);\n                    break;\n                case constant.MONSTER_ANI_TYPE.IDLE:\n                    this._aniState.speed = GameManager.gameSpeed;\n                    break;\n                default:\n                    this._aniState.speed = GameManager.gameSpeed;\n                    break;\n            }\n        }\n\n        if (!isLoop) {\n            this.aniComPlayer.once(SkeletalAnimationComponent.EventType.FINISHED, ()=>{\n                this.isAniPlaying = false;\n                callback && callback();\n            })\n        }\n    }\n\n}"]}