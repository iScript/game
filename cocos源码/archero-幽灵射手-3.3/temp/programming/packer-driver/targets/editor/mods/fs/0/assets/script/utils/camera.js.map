{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/utils/camera.ts"],"names":["_decorator","Component","Node","systemEvent","SystemEvent","EventMouse","Vec3","macro","Quat","ccclass","property","Camera","onLoad","start","_targetPos","node","position","onEnable","_addEvents","onDisable","_removeEvents","on","EventType","MOUSE_WHEEL","_onMouseWheel","MOUSE_MOVE","_onMouseMove","MOUSE_UP","_onMouseUp","MOUSE_DOWN","_onMouseDown","KEY_DOWN","_onKeyDown","KEY_UP","_onKeyUp","off","event","keyCode","KEY","w","_vertical","_ratio","s","a","_horizontal","d","getButton","BUTTON_LEFT","BUTTON_RIGHT","_panButtonDown","delta","getDelta","rotate","fromEuler","x","_rotateSpeed","NodeSpace","WORLD","y","LOCAL","wheel","getScrollY","_mouseWheelPos","set","translate","update","deltaTime","_translatePos","_speed"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, systemEvent, SystemEvent, EventMouse, Vec3, macro, Quat, Touch, CameraComponent } from 'cc';\nconst { ccclass, property } = _decorator;\n//方便上下移动摄像机观察\n@ccclass('Camera')\nexport class Camera extends Component {\n    lookButtonDown: boolean = false;\n    /* class member could be defined like this */\n    // dummy = '';\n\n    /* use `property` decorator if your want the member to be serializable */\n    // @property\n    // serializableDummy = 0;\n\n    private _targetPos: Vec3 = new Vec3();\n    private _vertical: number = 0;\n    private _horizontal: number = 0;\n    private _speed: number = 50;\n    private _rotateSpeed: number = 0.1;\n    private _panButtonDown: boolean = false;\n    private _ratio: number = 0.2;//倍率\n    private _translatePos: Vec3 = new Vec3();\n    private _mouseWheelPos: Vec3 = new Vec3();\n\n    onLoad () {\n    }\n\n    start () {\n        this._targetPos = this.node.position;\n    }\n\n    onEnable () {\n\t\tthis._addEvents();\n\t}\n\n\tonDisable () {\n        this._removeEvents();\n    }\n    \n    private _addEvents () {\n\t\tsystemEvent.on(SystemEvent.EventType.MOUSE_WHEEL, this._onMouseWheel, this);\n\t\tsystemEvent.on(SystemEvent.EventType.MOUSE_MOVE, this._onMouseMove, this);\n\t\tsystemEvent.on(SystemEvent.EventType.MOUSE_UP, this._onMouseUp, this);\n        systemEvent.on(SystemEvent.EventType.MOUSE_DOWN, this._onMouseDown, this);\n        \n        systemEvent.on(SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\n        systemEvent.on(SystemEvent.EventType.KEY_UP, this._onKeyUp, this);\n\t}\n\n\tprivate _removeEvents () {\n\t\tsystemEvent.off(SystemEvent.EventType.MOUSE_WHEEL, this._onMouseWheel, this);\n\t\tsystemEvent.off(SystemEvent.EventType.MOUSE_MOVE, this._onMouseMove, this);\n\t\tsystemEvent.off(SystemEvent.EventType.MOUSE_UP, this._onMouseUp, this);\n\t\tsystemEvent.off(SystemEvent.EventType.MOUSE_DOWN, this._onMouseDown, this);\n        \n        systemEvent.off(SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\n        systemEvent.off(SystemEvent.EventType.KEY_UP, this._onKeyUp, this);\n    }\n\n    private _onKeyDown (event: any) {\n        if (event.keyCode == macro.KEY.w) {\n            this._vertical = -1 * this._ratio;\n        } else if (event.keyCode == macro.KEY.s) {\n            this._vertical = 1 * this._ratio;\n        } else if (event.keyCode == macro.KEY.a) {\n            this._horizontal = -1 * this._ratio;\n        } else if (event.keyCode == macro.KEY.d) {\n            this._horizontal = 1 * this._ratio;\n        }\n    }\n\n    private _onKeyUp (event: any) {\n        if (event.keyCode == macro.KEY.w && this._vertical < 0) {\n            this._vertical = 0;\n        } else if (event.keyCode == macro.KEY.s && this._vertical > 0) {\n            this._vertical = 0;\n        } else if (event.keyCode == macro.KEY.a && this._horizontal < 0) {\n            this._horizontal = 0;\n        } else if (event.keyCode == macro.KEY.d && this._horizontal > 0) {\n            this._horizontal = 0;\n        }\n    }\n    \n    private _onMouseDown (event: any) {\n        switch (event.getButton()) {\n            case EventMouse.BUTTON_LEFT:\n                // this.lookButtonDown = true;\n                break;\n            // case EventMouse.BUTTON_MIDDLE:\n            case EventMouse.BUTTON_RIGHT:\n                this._panButtonDown = true;\n                break;\n        }\n    };\n    \n    \n    private _onMouseUp (event: any) {\n        switch (event.getButton()) {\n            case EventMouse.BUTTON_LEFT:\n                // this.lookButtonDown = false;\n                break;\n            // case EventMouse.BUTTON_MIDDLE:\n            case EventMouse.BUTTON_RIGHT:\n                this._panButtonDown = false;\n                break;\n        }\n    };\n    \n    \n    private _onMouseMove (event: EventMouse) {\n        if (this._panButtonDown) {\n            let delta = event.getDelta();\n            // this.targetPos.x -= delta.x;\n            // this.targetPos.y -= delta.y;\n\n            this.node.rotate(Quat.fromEuler(new Quat(), 0, -delta.x * this._rotateSpeed, 0), Node.NodeSpace.WORLD);\n\n            this.node.rotate(Quat.fromEuler(new Quat(), delta.y * this._rotateSpeed, 0, 0), Node.NodeSpace.LOCAL);\n        }\n        \n    }\n    \n    \n    private _onMouseWheel (event: EventMouse) {\n\n        let wheel = 0;\n        if (event.getScrollY() > 0) {\n            wheel = -1 * this._ratio;\n        } else if (event.getScrollY() < 0) {\n            wheel = 1 * this._ratio;\n        }\n\n        this._mouseWheelPos.set(0, 0, wheel * 10);\n        this.node.translate(this._mouseWheelPos, Node.NodeSpace.LOCAL);\n    }\n\n    update (deltaTime: number) {\n        // Your update function goes here.\n\n        this._translatePos.set(this._horizontal * deltaTime * this._speed, 0, this._vertical * deltaTime * this._speed);\n        this.node.translate(this._translatePos, Node.NodeSpace.LOCAL);\n    }\n}\n"]}