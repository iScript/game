{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/ui/debug/debugPanel.ts"],"names":["_decorator","Component","Node","Prefab","game","PhysicsSystem","profiler","GameManager","DebugSkillItem","constant","DebugLevelItem","poolManager","playerData","uiManager","localConfig","StorageManager","clientEvent","EffectManager","AudioManager","ccclass","property","DebugPanel","start","show","isGamePause","_initLevelView","_initSkillView","mapInfo","instance","getTableArr","ndContentLevel","children","forEach","item","active","itemInfo","idx","arr","ndChild","length","getNode","pbLevelItem","scriptDebugLevelItem","getComponent","init","playerSkillInfo","concat","filter","ID","PLAYER_SKILL","RECOVERY","ndContentPlayerSkill","pbSkillItem","onBtnCloseClick","playSound","SOUND","CLICK","hideDialog","onBtnClearStorageClick","playerInfo","history","settings","saveAll","jsonData","save","showTips","onToggleFrame30Click","setGlobalData","setFrameRate","fixedTimeStep","_showState","onToggleFrame60Click","onBtnClearPlayerSkillClick","arrSkill","savePlayerInfoToLocalCache","dispatchEvent","EVENT_TYPE","PARSE_PLAYER_SKILL","onBtnSelectAllPlayerSkillClick","GET_SKILL","push","playEffect","ndPlayer","isDebugOpen","getGlobalData","showStats","hideStats"],"mappings":"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","sourcesContent":["import { GameManager } from './../../fight/gameManager';\nimport { DebugSkillItem } from './debugSkillItem';\nimport { constant } from './../../framework/constant';\nimport { DebugLevelItem } from './debugLevelItem';\nimport { poolManager } from './../../framework/poolManager';\nimport { playerData } from './../../framework/playerData';\nimport { uiManager } from './../../framework/uiManager';\nimport { localConfig } from './../../framework/localConfig';\nimport { _decorator, Component, Node, Prefab, ToggleComponent, game, PhysicsSystem, profiler } from 'cc';\nimport { StorageManager } from '../../framework/storageManager';\nimport { clientEvent } from '../../framework/clientEvent';\nimport { EffectManager } from '../../framework/effectManager';\nimport { AudioManager } from '../../framework/audioManager';\nconst { ccclass, property } = _decorator;\n\n@ccclass('DebugPanel')\nexport class DebugPanel extends Component {\n    @property(Node)\n    public ndContentLevel: Node = null!;\n\n    @property(Node)\n    public ndContentPlayerSkill: Node = null!;\n\n    @property(Prefab)\n    public pbLevelItem: Prefab = null!;\n\n    @property(Prefab)\n    public pbSkillItem: Prefab = null!;\n\n    start () {\n        // [3]\n    }\n\n    public show () {\n        GameManager.isGamePause = true;\n\n        this._initLevelView();\n        this._initSkillView();\n    }\n\n    /**\n     * 初始化关卡列表\n     *\n     * @private\n     * @memberof DebugPanel\n     */\n    private _initLevelView () {\n        let mapInfo = localConfig.instance.getTableArr(\"checkpoint\");\n\n        this.ndContentLevel.children.forEach((item: Node)=>{\n            item.active = false;\n        })\n        \n        mapInfo.forEach((itemInfo: any, idx: number, arr: any) => {\n            let ndChild: Node = null!;\n\n            if (idx < this.ndContentLevel.children.length) {\n                ndChild = this.ndContentLevel.children[idx];\n            } else {\n                ndChild = poolManager.instance.getNode(this.pbLevelItem, this.ndContentLevel);\n            }\n\n            ndChild.active = true;\n            let scriptDebugLevelItem = ndChild.getComponent(DebugLevelItem) as DebugLevelItem;\n            scriptDebugLevelItem.init(itemInfo);\n        });\n    }\n\n    /**\n     * 初始化玩家技能列表\n     *\n     * @private\n     * @memberof DebugPanel\n     */\n    private _initSkillView () {\n        let playerSkillInfo = localConfig.instance.getTableArr(\"playerSkill\");\n        //策划说回复生命的不出现在技能列表里面\n        playerSkillInfo = playerSkillInfo.concat().filter((item: any)=>{\n            return item.ID !== constant.PLAYER_SKILL.RECOVERY;\n        })\n\n        this.ndContentPlayerSkill.children.forEach((item: Node)=>{\n            item.active = false;\n        })\n        \n        playerSkillInfo.forEach((itemInfo: any, idx: number, arr: any) => {\n            let ndChild: Node = null!;\n\n            if (idx < this.ndContentPlayerSkill.children.length) {\n                ndChild = this.ndContentPlayerSkill.children[idx];\n            } else {\n                ndChild = poolManager.instance.getNode(this.pbSkillItem, this.ndContentPlayerSkill);\n            }\n\n            ndChild.active = true;\n            let scriptDebugLevelItem = ndChild.getComponent(DebugSkillItem) as DebugSkillItem;            \n            scriptDebugLevelItem.init(itemInfo);\n        });        \n    }\n\n    /**\n     * 关闭按钮\n     *\n     * @memberof DebugPanel\n     */\n    public onBtnCloseClick () {\n        AudioManager.instance.playSound(constant.SOUND.CLICK);\n\n        uiManager.instance.hideDialog(\"debug/debugPanel\");\n\n        GameManager.isGamePause = false;\n    }\n\n    /**\n     * 清除玩家缓存\n     *\n     * @memberof DebugPanel\n     */\n    public onBtnClearStorageClick () {\n        AudioManager.instance.playSound(constant.SOUND.CLICK);\n\n        playerData.instance.playerInfo = {};\n        playerData.instance.history = {};\n        playerData.instance.settings = {};\n        playerData.instance.saveAll();\n\n        StorageManager.instance.jsonData = {};\n        StorageManager.instance.save();\n        uiManager.instance.showTips(\"游戏缓存已清除，请完全关闭游戏并重新打开！\");\n    }\n\n    /**\n     * 切换30帧\n     *\n     * @memberof DebugPanel\n     */\n    public onToggleFrame30Click () {\n        AudioManager.instance.playSound(constant.SOUND.CLICK);\n\n        uiManager.instance.showTips(\"游戏已经切换为30帧\");\n        StorageManager.instance.setGlobalData(\"frameRate\", 30);\n        game.setFrameRate(30);\n        PhysicsSystem.instance.fixedTimeStep = 1 / 30;\n        \n        this._showState();\n    }\n\n    /**\n     * 切换60帧\n     *\n     * @memberof DebugPanel\n     */\n    public onToggleFrame60Click () {\n        AudioManager.instance.playSound(constant.SOUND.CLICK);\n\n        uiManager.instance.showTips(\"游戏已经切换为60帧\");\n        StorageManager.instance.setGlobalData(\"frameRate\", 60);\n        game.setFrameRate(60);\n        PhysicsSystem.instance.fixedTimeStep = 1 / 60;\n\n        this._showState();\n    }\n\n    /**\n     * 清除玩家全部技能\n     *\n     * @memberof DebugPanel\n     */\n    public onBtnClearPlayerSkillClick () {\n        AudioManager.instance.playSound(constant.SOUND.CLICK);\n\n        playerData.instance.playerInfo.arrSkill = [];\n        playerData.instance.savePlayerInfoToLocalCache();\n        clientEvent.dispatchEvent(constant.EVENT_TYPE.PARSE_PLAYER_SKILL);\n        this._initSkillView();\n    }\n\n    /**\n     *  拥有玩家全部技能\n     *\n     * @memberof DebugPanel\n     */\n    public onBtnSelectAllPlayerSkillClick () {\n        AudioManager.instance.playSound(constant.SOUND.GET_SKILL);\n\n        let arrSkill = localConfig.instance.getTableArr(\"playerSkill\");\n        let arr: any = [];\n        arrSkill.forEach((item: any) => {\n            //生命回复改成在游戏内获得，不通过技能列表获得\n            if (item.ID !== constant.PLAYER_SKILL.RECOVERY) {\n                arr.push(item.ID);\n            }\n        });\n\n        playerData.instance.playerInfo.arrSkill = arr;\n        playerData.instance.savePlayerInfoToLocalCache();\n        clientEvent.dispatchEvent(constant.EVENT_TYPE.PARSE_PLAYER_SKILL);\n        this._initSkillView();\n\n        EffectManager.instance.playEffect(GameManager.ndPlayer, \"levelUp/levelUp\");\n    }\n\n    /**\n     * 切换调试状态\n     *\n     * @private\n     * @memberof DebugPanel\n     */\n    private _showState () {\n        let isDebugOpen = StorageManager.instance.getGlobalData(\"debug\") ?? false;\n        isDebugOpen ? profiler.showStats() : profiler.hideStats();\n    }\n}"]}