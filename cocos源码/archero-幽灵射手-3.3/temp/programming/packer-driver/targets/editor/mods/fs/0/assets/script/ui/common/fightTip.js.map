{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/ui/common/fightTip.ts"],"names":["LabelComponent","tween","Vec3","UITransformComponent","view","_decorator","Component","find","poolManager","constant","util","GameManager","ccclass","property","FightTip","objectToArray","BLOOD_TIP_DIRECTION","start","show","scriptParent","tipType","bloodNum","callback","_closeTweenTip","node","eulerAngles","_oriAngle","setScale","_oriScale","_isChangePos","_oriWorPos","set","worldPosition","arrChildren","children","forEach","item","active","UICom","getComponent","priority","PRIORITY","BLOOD_TIP","Math","round","lbHitNum","ndSub","FIGHT_TIP","ADD_BLOOD","getChildByName","REDUCE_BLOOD","CRITICAL_HIT","BLOOD_CRITICAL_TIP","string","String","pos","getPosition","width","height","abs","x","getCanvasSize","w","y","h","setPosition","getTargetPos","_tweenTip","to","_costTime","scale","_scale_1","easing","_scale_2","call","instance","putNode","dir","arr","_arrDirection","concat","filter","bloodTipDirection","floor","random","length","LEFT_UP","_targetPos","MID_UP","RIGHT_UP","add","clone","stop","update","deltaTime","lerp","mainCamera","convertToUINode","_curWorPos"],"mappings":"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","sourcesContent":["import { poolManager } from './../../framework/poolManager';\nimport { constant } from './../../framework/constant';\nimport { LabelComponent, tween, Vec3, UITransformComponent, view, _decorator, Component, Node, find  } from 'cc';\nimport { util } from '../../framework/util';\nimport { GameManager } from '../../fight/gameManager';\n//战斗血量增减提示组件\nconst { ccclass, property } = _decorator;\n\n@ccclass('FightTip')\nexport class FightTip extends Component {\n\n    private _tweenTip: any = null;//tween实例\n    private _costTime: number = 1.5;//缓动所需时间\n    private _arrDirection: any = util.objectToArray(constant.BLOOD_TIP_DIRECTION);//三个不同方向\n    private _isChangePos: boolean = false;//是否改变位置\n    private _targetPos: Vec3 = new Vec3(0, 200, 0);//目标位置\n    private _oriWorPos: Vec3 = new Vec3();//初始位置\n    private _curWorPos: Vec3  = new Vec3();//当前位置\n    private _oriScale: Vec3 = new Vec3(0.7, 0.7, 0.7);//初始缩放\n    private _oriAngle: Vec3 = new Vec3();//初始角度\n    private _scale_1: Vec3 = new Vec3(1, 1, 1);//最开始缩放\n    private _scale_2: Vec3 = new Vec3();//最终缩放\n\n    start () {\n        // Your initialization goes here.\n    }\n\n    /**\n     * 展示血量提示\n     *\n     * @param {*} scriptParent 关联的血条脚本\n     * @param {number} tipType 提示类型\n     * @param {string} bloodNum 数值\n     * @param {Function} [callback] 回调函数\n     * @memberof FightTip\n     */\n    public show (scriptParent: any, tipType: number, bloodNum: number, callback?: Function) {\n        this._closeTweenTip();\n        this.node.eulerAngles = this._oriAngle;\n        this.node.setScale(this._oriScale);\n        \n        this._isChangePos = false;\n\n        this._oriWorPos.set(scriptParent.node.worldPosition);\n\n        let arrChildren = this.node.children;\n        arrChildren.forEach((item)=>{\n            item.active = false;\n        })\n\n\n        let UICom = this.node.getComponent(UITransformComponent) as UITransformComponent;\n        UICom.priority = constant.PRIORITY.BLOOD_TIP;\n\n        bloodNum = Math.round(bloodNum);\n\n        let lbHitNum;\n        let ndSub: Node = null!;\n        if (tipType === constant.FIGHT_TIP.ADD_BLOOD) {\n            ndSub = this.node.getChildByName(\"addBlood\") as Node;\n        } else if (tipType === constant.FIGHT_TIP.REDUCE_BLOOD) {\n            ndSub = this.node.getChildByName(\"reduceBlood\") as Node;\n        } else if (tipType === constant.FIGHT_TIP.CRITICAL_HIT) {\n            ndSub = this.node.getChildByName(\"criticalHit\") as Node;\n            UICom.priority = constant.PRIORITY.BLOOD_CRITICAL_TIP;\n        }\n\n        lbHitNum = ndSub.getChildByName('num')?.getComponent(LabelComponent);\n        lbHitNum && (lbHitNum.string = String(bloodNum));\n\n        ndSub.active = true;\n\n        let pos = this.node.getPosition();\n        let width:number = ndSub.getComponent(UITransformComponent)?.width!;\n        let height:number = ndSub.getComponent(UITransformComponent)?.height!;\n        if ((Math.abs(pos.x) + width / 2) > view.getCanvasSize().width / 2) {\n            let w = view.getCanvasSize().width / 2 - width / 2;\n            pos.x = pos.x > 0 ? w : -w;\n        }\n\n        if ((Math.abs(pos.y) + height / 2) > view.getCanvasSize().height / 2) {\n            let h = view.getCanvasSize().height / 2 - height / 2;\n            pos.y = pos.y > 0 ? h : -h;\n        }\n        this.node.setPosition(pos);\n\n        this.getTargetPos(scriptParent);\n\n        this._isChangePos = true;\n\n        this._tweenTip = tween(this.node)\n        .to(this._costTime * 0.4, {scale: this._scale_1}, {easing: 'smooth'})\n        .to(this._costTime * 0.2, {scale: this._scale_2}, {easing: \"backIn\"})\n        .call(()=>{\n            this._closeTweenTip();\n            poolManager.instance.putNode(this.node);\n            callback && callback();\n            this._isChangePos = false;\n        })\n        .start();\n    }\n\n    /**\n     * 获取跟上次血量提示不一样方向的提示\n     */\n    private getTargetPos (scriptParent: any) {\n        let dir: number;\n        let arr = this._arrDirection.concat();\n        \n        arr = arr.filter((item: any)=>{\n            return item !== scriptParent.bloodTipDirection;\n        });\n\n        dir = arr[Math.floor(Math.random() * arr.length)];\n        switch (dir) {\n            case constant.BLOOD_TIP_DIRECTION.LEFT_UP:\n                this._targetPos.set(-2, 5, 0);\n                break;\n            case constant.BLOOD_TIP_DIRECTION.MID_UP:\n                this._targetPos.set(0, 4, 0);\n                break;\n            case constant.BLOOD_TIP_DIRECTION.RIGHT_UP:\n                this._targetPos.set(2, 2, 0);\n                break;\n            default:\n                break;\n        }\n        \n        this._targetPos.add(scriptParent.node.worldPosition.clone());\n\n        scriptParent.bloodTipDirection = dir;\n    }\n\n    private _closeTweenTip () {\n        if (this._tweenTip) {\n            this._tweenTip.stop();\n            this._tweenTip = null;  \n        }\n    }\n\n    update (deltaTime: number) {\n        // Your update function goes here.\n\n        if (this._isChangePos) {\n            this._oriWorPos.lerp(this._targetPos, 0.05);\n            GameManager.mainCamera?.convertToUINode(this._oriWorPos, find('Canvas') as Node, this._curWorPos);\n\n            this.node.setPosition(this._curWorPos);\n        }\n    }\n\n}\n"]}