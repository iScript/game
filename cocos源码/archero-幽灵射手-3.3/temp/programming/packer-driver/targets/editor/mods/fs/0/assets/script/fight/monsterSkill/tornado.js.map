{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/fight/monsterSkill/tornado.ts"],"names":["_decorator","Component","Vec3","Node","AnimationComponent","poolManager","GameManager","EffectManager","util","constant","AudioManager","ccclass","property","Tornado","start","init","skillInfo","baseInfo","scriptParent","scriptWarning","hideWarning","_oriWorPos","set","node","worldPosition","_curWorPos","subtract","_offsetPos","ndPlayer","normalize","negative","add","multiplyScalar","setWorldPosition","instance","playTrail","_targetSpeed","flySpeed","_curSpeed","aniMove","getState","time","sample","play","playSound","SOUND","TORNADO","update","deltaTime","lerp","_targetWorPos","translate","NodeSpace","LOCAL","length","_disappearRange","putNode"],"mappings":"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","sourcesContent":["import { poolManager } from './../../framework/poolManager';\nimport { GameManager } from './../gameManager';\nimport { _decorator, Component, Vec3, profiler, Node, AnimationComponent } from 'cc';\nimport { EffectManager } from '../../framework/effectManager';\nimport { util } from '../../framework/util';\nimport { constant } from '../../framework/constant';\nimport { AudioManager } from '../../framework/audioManager';\nconst { ccclass, property } = _decorator;\n//台风S型组件\n@ccclass('Tornado')\nexport class Tornado extends Component {\n    @property(AnimationComponent)\n    public aniMove: AnimationComponent = null!;\n\n    public skillInfo: any = null!;//技能信息\n    public baseInfo: any = null!;//基础信息\n\n    private _offsetPos: Vec3 = new Vec3();//当前坐标和玩家坐标的向量差\n    private _oriWorPos: Vec3 = new Vec3();//初始位置\n    private _targetSpeed: number = 0;//目标速度\n    private _curSpeed: number = 0;//当前速度\n    private _targetWorPos: Vec3 = new Vec3();//目标位置\n    private _curWorPos: Vec3 = new Vec3();//当前位置\n    private _disappearRange: number = 25;//箭节点超过玩家这个范围则隐藏\n\n    start () {\n        // [3]\n    }\n\n    public init (skillInfo: any, baseInfo: any, scriptParent?: any) {\n        this.skillInfo = skillInfo;\n        this.baseInfo = baseInfo;\n        scriptParent?.scriptWarning?.hideWarning();\n        this._oriWorPos.set(this.node.worldPosition);\n        this._curWorPos.set(this.node.worldPosition);\n        Vec3.subtract(this._offsetPos, this._curWorPos, GameManager.ndPlayer.worldPosition);\n        this._offsetPos.normalize().negative();\n        Vec3.add(this._curWorPos, this._curWorPos, this._offsetPos.multiplyScalar(2));\n        this.node.setWorldPosition(this._curWorPos);\n\n        EffectManager.instance.playTrail(this.node);\n        this._targetSpeed = skillInfo.flySpeed;\n        this._curSpeed = this._targetSpeed * 0.5;\n\n        this.aniMove.getState(\"tornado\").time = 0;\n        this.aniMove.getState(\"tornado\").sample();\n        this.aniMove.play();\n\n        AudioManager.instance.playSound(constant.SOUND.TORNADO);  \n\n    }\n\n    update (deltaTime: number) {\n        if (GameManager.ndPlayer) {\n            //朝forward方向飞行\n            this._curSpeed = util.lerp(this._targetSpeed, this._curSpeed, 0.25);\n            this._targetWorPos.set(0, 0, -deltaTime * this._curSpeed);\n            this.node.translate(this._targetWorPos, Node.NodeSpace.LOCAL);\n            this._curWorPos.set(this.node.worldPosition);\n\n            //超过玩家一定范围则隐藏\n            Vec3.subtract(this._offsetPos, this._curWorPos, GameManager.ndPlayer.worldPosition);\n            if (this._offsetPos && this._offsetPos.length() >= this._disappearRange) {\n                poolManager.instance.putNode(this.node);\n            }\n        }\n    }\n}"]}