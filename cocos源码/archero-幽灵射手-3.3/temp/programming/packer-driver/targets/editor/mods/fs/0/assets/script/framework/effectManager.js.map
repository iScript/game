{"version":3,"sources":["file:///Users/ykq/Downloads/archero/assets/script/framework/effectManager.ts"],"names":["_decorator","Component","AnimationComponent","ParticleSystemComponent","Vec3","find","AnimationClip","poolManager","resourceUtil","WarningCircle","Reward","WarningStrip","WarningLine","v3_goldPos","ccclass","property","EffectManager","ndParent","_ndParent","instance","_instance","start","playAni","path","aniName","worPos","isLoop","isRecycle","scale","callback","childName","split","ndEffect","getChildByName","cb","setScale","setWorldPosition","ani","getComponent","play","aniState","getState","wrapMode","WrapMode","Loop","Normal","once","EventType","FINISHED","putNode","loadModelRes","then","prefab","getNode","removeEffect","name","arrAni","getComponentsInChildren","forEach","element","stop","arrParticle","clear","playParticle","recycleTime","eulerAngles","loadEffectRes","maxDuration","item","simulationSpeed","duration","seconds","setTimeout","parent","playEffect","targetNode","effectPath","isPlayAni","isPlayParticle","pos","setPosition","idx","defaultClip","speed","showRewardBounce","ndMonster","modelPath","rewardNum","pf","i","ndReward","worldPosition","x","z","active","scriptReward","init","playTrail","showWarning","warningName","scriptParent","ndWarning","scriptWarning","showLightningChain","ndTarget","offsetPos","subtract","setWorldScale","length","forward","normalize","negative"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, AnimationComponent, ParticleSystemComponent, Vec3, find, AnimationState, AnimationClip, math } from 'cc';\nimport { poolManager } from './poolManager';\nimport { resourceUtil } from './resourceUtil';\nimport { WarningCircle } from '../fight/warningSkill/warningCircle';\nimport { Reward } from '../fight/reward';\nimport { WarningStrip } from '../fight/warningSkill/warningStrip';\nimport { WarningLine } from '../fight/warningSkill/warningLine';\n\nconst v3_goldPos: Vec3 = new Vec3();\nconst { ccclass, property } = _decorator;\n\n@ccclass('EffectManager')\nexport class EffectManager extends Component {\n    private _ndParent: Node = null!;\n    private _ndGoldParent: Node = null!\n    public get ndParent () {\n        if (!this._ndParent) {\n            this._ndParent = find(\"effectManager\") as Node;\n        }\n\n        return this._ndParent\n    }\n\n    static _instance: EffectManager;\n\n    static get instance () {\n        if (this._instance) {\n            return this._instance;\n        }\n\n        this._instance = new EffectManager();\n        return this._instance;\n    }\n\n    start () {\n       \n    }\n\n    /**\n     * 播放模型的动画\n     * @param {string} path 动画节点路径\n     * @param {string} aniName \n     * @param {vec3} worPos 世界坐标\n     * @param {boolean} isLoop 是否循环\n     * @param {boolean} isRecycle 是否回收\n     * @param {number} [scale=1] 缩放倍数 \n     * @param {Function} [callback=()=>{}] 回调函数 \n     */\n    public playAni (path: string, aniName: string, worPos: Vec3 = new Vec3(),  isLoop: boolean = false,  isRecycle: boolean = false, scale: number = 1, callback: Function = ()=>{}) {\n        let childName: string = path.split(\"/\")[1];\n        let ndEffect: Node | null = this.ndParent.getChildByName(childName);\n\n        let cb = ()=>{\n            ndEffect?.setScale(new Vec3(scale, scale, scale));\n            ndEffect?.setWorldPosition(worPos); \n            let ani: AnimationComponent= ndEffect?.getComponent(AnimationComponent) as AnimationComponent;\n            ani.play(aniName);\n            let aniState: AnimationState= ani.getState(aniName) as AnimationState;\n            if (aniState) {\n                if (isLoop) {\n                    aniState.wrapMode = AnimationClip.WrapMode.Loop;    \n                } else {\n                    aniState.wrapMode = AnimationClip.WrapMode.Normal;    \n                }\n            }\n\n            ani.once(AnimationComponent.EventType.FINISHED, ()=>{\n                callback && callback();\n                if (isRecycle && ndEffect) {\n                    poolManager.instance.putNode(ndEffect);\n                }\n            })\n        }\n\n        if (!ndEffect) {\n            resourceUtil.loadModelRes(path).then((prefab: any)=>{\n                ndEffect = poolManager.instance.getNode(prefab as Prefab, this.ndParent) as Node;\n                ndEffect.setScale(new Vec3(scale, scale, scale));\n                ndEffect.setWorldPosition(worPos);                \n                cb();\n            })\n        } else {\n          cb();\n        }\n    }\n\n    /**\n     * 移除特效\n     * @param {string} name  特效名称\n     * @param {Node}} ndParent 特效父节点\n     */\n    public removeEffect (name: string, ndParent: Node = this.ndParent) {\n        let ndEffect: Node | null = ndParent.getChildByName(name);\n        if (ndEffect) {\n            let arrAni: AnimationComponent[] = ndEffect.getComponentsInChildren(AnimationComponent);\n            arrAni.forEach((element: AnimationComponent)=>{    \n                element.stop();\n            })\n\n            let arrParticle: [] = ndEffect?.getComponentsInChildren(ParticleSystemComponent) as any;\n            arrParticle.forEach((element:ParticleSystemComponent)=>{\n                element?.clear();\n                element?.stop();\n            })\n            poolManager.instance.putNode(ndEffect);        \n        }\n    }\n\n    /**\n     * 播放粒子特效\n     * @param {string} path 特效路径\n     * @param {vec3}worPos 特效世界坐标 \n     * @param {number} [recycleTime=0] 特效节点回收时间，如果为0，则使用默认duration\n     * @param  {number} [scale=1] 缩放倍数\n     * @param {vec3} eulerAngles 特效角度\n     * @param {Function} [callback=()=>{}] 回调函数\n     */\n    public playParticle (path: string, worPos: Vec3,  recycleTime: number = 0, scale: number = 1, eulerAngles?: Vec3 | null, callback?: Function) {\n        resourceUtil.loadEffectRes(path).then((prefab: any)=>{\n            let ndEffect: Node = poolManager.instance.getNode(prefab as Prefab, this.ndParent) as Node;\n            ndEffect.setScale(new Vec3(scale, scale, scale));\n            ndEffect.setWorldPosition(worPos);  \n            \n            if (eulerAngles) {\n                ndEffect.eulerAngles = eulerAngles;\n            }\n            \n            let maxDuration: number = 0;\n\n            let arrParticle:  ParticleSystemComponent[]= ndEffect.getComponentsInChildren(ParticleSystemComponent);\n            arrParticle.forEach((item: ParticleSystemComponent)=>{\n                item.simulationSpeed = 1;\n                item?.clear();\n                item?.stop();\n                item?.play()\n\n                let duration: number= item.duration;\n                maxDuration = duration > maxDuration ? duration : maxDuration;\n            })\n\n            let seconds: number = recycleTime && recycleTime > 0 ? recycleTime : maxDuration;\n\n            setTimeout(()=>{\n                if (ndEffect.parent) {\n                    poolManager.instance.putNode(ndEffect);\n                    callback && callback();\n                }\n            }, seconds * 1000)  \n        })\n    }\n\n    /**\n     * 播放节点下面的动画和粒子\n     *\n     * @param {Node} targetNode 特效挂载节点\n     * @param {string} effectPath 特效路径\n     * @param {boolean} [isPlayAni=true] 是否播放动画\n     * @param {boolean} [isPlayParticle=true] 是否播放特效\n     * @param {number} [recycleTime=0] 特效节点回收时间，如果为0，则使用默认duration\n     * @param {number} [scale=1] 缩放倍数\n     * @param {Vec3} [pos=new Vec3()] 位移\n     * @param {Function} [callback=()=>{}] 回调函数\n     * @returns\n     * @memberof EffectManager\n     */\n    public playEffect (targetNode: Node, effectPath: string, isPlayAni: boolean = true, isPlayParticle: boolean = true, recycleTime: number = 0, scale: number = 1, pos?: Vec3 | null, eulerAngles?: Vec3 | null, callback?: Function) {\n        if (!targetNode.parent) {//父节点被回收的时候不播放\n            return;\n        }\n\n        resourceUtil.loadEffectRes(effectPath).then((prefab: any)=>{\n            let ndEffect: Node = poolManager.instance.getNode(prefab as Prefab, targetNode) as Node;\n            ndEffect.setScale(new Vec3(scale, scale, scale));\n\n            if (pos) {\n                ndEffect.setPosition(pos);\n            }\n\n            if (eulerAngles) {\n                ndEffect.eulerAngles = eulerAngles;\n            }\n\n            let maxDuration: number = 0;\n\n            if (isPlayAni) {\n                let arrAni: AnimationComponent[] = ndEffect.getComponentsInChildren(AnimationComponent);\n    \n                arrAni.forEach((element: AnimationComponent, idx: number)=>{\n                    element?.play();\n                    \n                    let aniName = element?.defaultClip?.name;\n                    if (aniName) {\n                        let aniState = element.getState(aniName);\n                        if (aniState) {\n                            let duration = aniState.duration;\n                            maxDuration = duration > maxDuration ? duration : maxDuration;\n\n                            aniState.speed = 1;\n                        }\n                    }\n                })\n            }\n    \n            if (isPlayParticle) {\n                let arrParticle: ParticleSystemComponent[]= ndEffect.getComponentsInChildren(ParticleSystemComponent);\n                arrParticle.forEach((element:ParticleSystemComponent)=>{\n                    element.simulationSpeed = 1;\n                    element?.clear();\n                    element?.stop();\n                    element?.play()\n    \n                    let duration: number= element.duration;\n                    maxDuration = duration > maxDuration ? duration : maxDuration;\n                })\n            }\n    \n            let seconds: number = recycleTime && recycleTime > 0 ? recycleTime : maxDuration;\n            \n            setTimeout(()=>{\n                if (ndEffect.parent) {\n                    poolManager.instance.putNode(ndEffect);\n                    callback && callback();\n                }\n            }, seconds * 1000)  \n        })\n    }\n\n    /**\n     * 展示奖励(金币、爱心)弹跳\n     *\n     * @param {Node} ndMonster\n     * @param {string} modelPath\n     * @param {number} [rewardNum=1]\n     * @param {Function} [callback=()=>{}]\n     * @memberof EffectManager\n     */\n    public showRewardBounce (ndMonster: Node, modelPath: string, rewardNum: number = 1, callback: Function = ()=>{}) {\n        resourceUtil.loadModelRes(modelPath).then((pf: any)=>{\n            for (let i = 0; i < rewardNum; i++) {\n                let ndReward = poolManager.instance.getNode(pf, this.ndParent) as Node;\n                ndReward.setWorldPosition(ndMonster.worldPosition.x, 1.65, ndMonster.worldPosition.z);\n                ndReward.active = false;\n                let scriptReward = ndReward.getComponent(Reward) as Reward;\n                scriptReward.init((i+1) * 0.15, this.ndParent);\n            }\n\n            callback && callback();\n        });\n    }\n\n    /**\n     * 播放拖尾特效\n     *\n     * @param {Node} ndParent\n     * @memberof EffectManager\n     */\n    public playTrail (ndParent: Node, recycleTime:number = 0, callback?:Function, speed: number = 1) {\n        let maxDuration: number = 0;\n\n        let arrParticle: ParticleSystemComponent[]= ndParent.getComponentsInChildren(ParticleSystemComponent);\n        arrParticle.forEach((element:ParticleSystemComponent)=>{\n            element.simulationSpeed = speed;\n            element?.clear();\n            element?.stop();\n            element?.play();\n\n            let duration: number= element.duration;\n            maxDuration = duration > maxDuration ? duration : maxDuration;\n        })\n\n        let seconds: number = recycleTime && recycleTime > 0 ? recycleTime : maxDuration;\n\n        setTimeout(()=>{\n            callback && callback();\n        }, seconds * 1000)  \n    }\n\n    /**\n     * 展示预警\n     *\n     * @param {string} warningName\n     * @param {number} scale\n     * @param {*} scriptParent\n     * @memberof EffectManager\n     */\n    public showWarning (warningName: string, scale: number, scriptParent: any, callback?: Function) {\n        resourceUtil.loadEffectRes(`warning/${warningName}`).then((pf: any)=>{\n            let ndWarning = poolManager.instance.getNode(pf, this.ndParent) as Node;\n\n            let scriptWarning: any = null; \n            if (warningName === \"warningLine\") {\n                scriptWarning = ndWarning.getComponent(WarningLine) as WarningLine;\n            } else if (warningName === \"warningStrip\") {\n                scriptWarning = ndWarning.getComponent(WarningStrip) as WarningStrip;\n            } else if (warningName === \"warningCircle\") {\n                scriptWarning = ndWarning.getComponent(WarningCircle) as WarningCircle;\n            }\n\n            scriptWarning.init(scale, scriptParent);\n\n            scriptParent.scriptWarning = scriptWarning;\n\n            callback && callback();\n        });\n    }\n\n    public showLightningChain (ndParent: Node, ndTarget: Node) {\n        resourceUtil.loadEffectRes(`lightningChain/lightningChain`).then((pf: any)=>{\n            let ndEffect = poolManager.instance.getNode(pf, ndParent) as Node;\n            ndEffect.setWorldPosition(new Vec3(ndParent.worldPosition.x, 2.3, ndParent.worldPosition.z));\n\n            let offsetPos: Vec3 = new Vec3();\n\n            Vec3.subtract(offsetPos, ndTarget.worldPosition, ndParent.worldPosition);\n            ndEffect.setWorldScale(1, offsetPos.length(), 1);\n            ndEffect.forward = offsetPos.normalize().negative();\n            \n            setTimeout(()=>{\n                poolManager.instance.putNode(ndEffect);\n            }, 100)\n        });\n    }\n}\n"]}